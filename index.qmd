---
title: "A guide to writing good code <br>for the busy scientist"
name: "A guide to writing good code for the busy scientist"
author: "<br><b>Dax Kellie</b>, Shandiya Balasubramaniam, Martin Westgate  <br> 
![](images/logos/ALA_Logo.png){style='width: auto; height: 90px; margin-top: 50px; padding-left: 20px; padding-right: 20px'} 
![](images/logos/NCRIS_logo.png){style='width: auto; height: 90px; margin-top: 50px; padding-left: 20px; padding-right: 20px'} 
![](images/logos/CSIRO_logo.png){style='width: auto; height: 90px; margin-top: 50px; padding-left: 20px; padding-right: 20px'} <br><br> 
[{{< iconify simple-icons:bluesky size=lg fill='#fe4' >}}]{style='color:#08f;'} <span style='font-size: 2.5rem;'>@daxkellie.bsky.social</span> "
title-slide-attributes: 
  data-background-color: "#fde5ce"
  data-background-image: images/stripe-background.png
  data-background-size: cover
  data-background-opacity: "0.3"
format: 
  revealjs: 
    theme: [default, custom.scss] 
    transition-speed: fast
    embed-resources: true
    from: markdown+emoji
---

##  {#acknowledgement data-menu-title="Acknowledgement" background-image="images/beach-greeny.jpg" background-opacity="0.3"}

<br><br>

<center>[I acknowledge the Traditional Owners of the lands on which I live and work, the Dharawal, Wandi Wandian, and Gadigal people of the Yuin Nation, and pay my respects to Elders past and present. I recognise the significance of this environment to Traditional Owners, and acknowledge their continuing connection to Country.]{style="color:#000000;"}</center>

:::: aside
::: {style="font-size: 60%; color: #000000;"}
Bristol Point, Yuin Country
:::
::::


# We all want to write good code {background-color="#212932" style="color: #ffffff; font-size: 70%" transition="fade"}


## But good code doesn't just magically happen {background-color="#5C6836" style="color: #ffffff; font-size: 80%;"}

<center>![](images/oh-no-imagination.png)</center>

::: {.fragment .fade-in fragment-index=1 style="font-size: 90%;"}
<center>
<br>
[Despite many researchers using code, very few are trained in programming.<br>This increases the chance for messy or broken code in science.]{style="font-size:105%;"}
</center>
:::

:::: aside
::: {style="font-size: 70%;"}
[Alex Norris, webcomicname.com](https://webcomicname.com/)
:::
::::

## {background-image="images/wall-e.jpg" style="color: #ffffff;font-size: 90%;"}

:::{.absolute right=0 bottom=15}
[Research waste]{style="font-size:3.4rem; face-weight:bold;"} 
:::

:::: aside
::: {style="font-size: 50%;"}
[Purgar et al (2022). Quantifying research waste in ecology. *Nature Ecology & Evolution*](https://doi.org/10.1038/s41559-022-01820-0) \
[Sánchez-Tójar et al (2025). Code-sharing policies are associated with increased reproducibility potential of ecological findings. *Peer Community Journal*](https://doi.org/10.24072/pcjournal.541) \
[Image credit: Pixar, sourced from https://gizmodo.com/wall-e-tried-to-warn-us-1847335905](https://gizmodo.com/wall-e-tried-to-warn-us-1847335905)
:::
::::

## Supporting good coding practices at the ALA {style="font-size: 83%;"}

::::: columns
::: {.column width="33%"}
<center>

![](images/galah-galaxias_medium.png){height="300"}

[<https://galah.ala.org.au/>]{style="font-size:1.2rem;"} \ 
[<https://galaxias.ala.org.au/>]{style="font-size:1.2rem;"}


</center>
:::

::: {.column width="33%"}
<center>

![](images/twitter-card-preview_frog-small.png){height="300"}

[<https://labs.ala.org.au/>]{style="font-size:1.2rem;"}

</center>
:::

::: {.column width="33%"}
<center>

![](images/cleaner-shrimp_cover.png){height="300"}

[<https://cleaning-data-r.ala.org.au/>]{style="font-size:1.2rem;"}

</center>
:::
:::::


# How to write good code<br>for science {background-color="#212932" style="color: #ffffff; font-size: 70%" transition="fade"}

## {background-color="#665F41" style="color: #ffffff;"}

::: {style="font-size:85%;"}

<br><br>

[`{r} cli::symbol$cross`]{style="color:red;"} Example code<br>

:::

::: {.code style="font-size:55%;"}

```{r}
#| eval: false
#| echo: true
#| warning: false
#| message: false
# bad example
library(tidyverse)
library(galah)
library(janitor)
library(sf)
library(ozmaps)

galah_config(email="dax.kellie@csiro.au")
alaData<-galah_call()|>identify("perameles")|>filter(year==2003) |>
  select(group="basic",cl22)|>
  atlas_occurrences()|>
  select(recordID,scientificName,decimalLongitude,decimalLatitude,eventDate,cl22)|>
  janitor::clean_names()|>rename(state=cl22)|>
  mutate(event_date=lubridate::ymd(event_date))|>
  group_by(state)|>count()|>drop_na()
aus<-ozmaps::ozmap_states|>
  sf::st_transform(crs=4326)|>
  left_join(alaData, join_by(NAME==state))|>
  replace_na(list(n=0))

ggplot()+sf::geom_sf(data=aus,aes(fill=n),colour="grey60")+
  viridis::scale_fill_viridis(option="F",begin=0.2,direction=-1)+theme_void()+theme(legend.position="right")
```

:::

## Code style {background-color="#665F41" style="color: #ffffff;"}

::: {style="font-size:85%;"}

*  Write code like you write sentences, add spaces<br>

:::

::: {.code style="font-size:55%;"}

```{r}
#| eval: false
#| echo: true
#| warning: false
#| message: false
# better example
library(tidyverse)
library(galah)
library(janitor)
library(sf)
library(ozmaps)

galah_config(email = "dax.kellie@csiro.au")
alaData <- galah_call() |> identify("perameles") |> filter(year == 2003) |>
  select(group = "basic", cl22)|>
  atlas_occurrences() |>
  select(recordID, scientificName, decimalLongitude, decimalLatitude, eventDate, cl22) |>
  janitor::clean_names() |> rename(state = cl22) |>
  mutate(event_date = lubridate::ymd(event_date)) |>
  group_by(state) |> count() |> drop_na()
aus <- ozmaps::ozmap_states |>
  sf::st_transform(crs = 4326) |>
  left_join(alaData, join_by(NAME == state)) |>
  replace_na(list(n = 0))

ggplot() + sf::geom_sf(data = aus,aes(fill = n),colour = "grey60") +
  viridis::scale_fill_viridis(option = "F", begin = 0.2, direction = -1) + theme_void() + theme(legend.position = "right")
```

:::


## Code style {background-color="#665F41" style="color: #ffffff;"}

::: {style="font-size:85%;"}

*  Break tasks into smaller code chunks
*  Line breaks allow code to breathe

:::

::: {.code style="font-size:60%;"}

```{=html}
<style>
.shorter-chunk {
  height: 400px;
  overflow-y: auto;
}
</style>
```

```{r}
#| eval: false
#| echo: true
#| warning: false
#| message: false
#| class-source: shorter-chunk

# best example
library(tidyverse)
library(galah)
library(janitor)
library(sf)
library(ozmaps)

galah_config(email = "dax.kellie@csiro.au")

## Data

aus <- ozmap_states |>
  st_transform(crs = 4326) # fix projection

bandicoots <- galah_call() |>
  identify("perameles") |>
  filter(year == 2003) |>
  select(group = "basic", cl22) |>
  atlas_occurrences() 

bandicoots_clean <- bandicoots |>
  select(recordID, scientificName, decimalLongitude, 
         decimalLatitude, eventDate, cl22) |>
  janitor::clean_names() |> 
  rename(state = cl22) |>
  mutate(
    event_date = lubridate::ymd(event_date)
    ) 

state_counts <- bandicoots_clean |>
  group_by(state) |> 
  count() |> 
  drop_na()

aus_counts <- aus |>
  left_join(state_counts, join_by(NAME == state)) |>
  replace_na(list(n = 0))

## Map

ggplot() + 
  geom_sf(data = aus_counts,
          aes(fill = n),
          colour = "grey60") +
  viridis::scale_fill_viridis(option = "F", 
                              begin = 0.2, 
                              direction = -1) + 
  theme_void() + 
  theme(legend.position = "right")
```

:::

## Naming things {background-color="#212932" style="color: #ffffff;" transition="fade"}

::::: {style="font-size:70%;"}

:::: {.columns}
::: {.column width="50%"}

<center>Bad</center>

Objects

```{r}
#| eval: false
#| echo: true
DT_3_final # unclear
map1       # vague
mapOfMarineInvertsFilteredByYear # too long
```

<br>

Functions

```{r}
#| eval: false
#| echo: true
func1() # unclear
filter() # unclear, already used
remove_outlier_if_out_of_range() # too long
```


:::

::: {.column width="50%"}

<center>Good</center>

Objects

```{r}
#| eval: false
#| echo: true
cockatoos_grouped
map_inverts
map_inverts_marine
```

<br>

Functions

```{r}
#| eval: false
#| echo: true
get_counts() 
remove_outliers() 
has_outlier()
```

:::
::::
:::::

## Naming things {background-color="#212932" style="color: #ffffff;" transition="fade"}

::::: {style="font-size: 70%;"}

Datset variable names

*  Variable names align with terms in final paper
*  Define variables in a README or in-text section

Example: 

:::: {.columns}
::: {.column width="50%" style="font-size:60%;"}
`site_id` = Unique site ID \
`individual_id` = Unique ID of each individual \
`scientific_name` = genus and species name \
`group` = Unique group ID (`control`, `high_condition`, `low_condition`) \
`leaf_length` = Length of leaf (mm) \
`leaf_width` = Width of leaf (mm) \
`leaf_mass_per_area` = Leaf dry mass per area, ratio of leaf size to density (g/m^2^) \
`temp_max` = Maximum temperature, 2023 (C°) \
`soil_n` = Soil nitrogen (mg/kg) \
:::
::: {.column width="50%"}

```{r}
#| echo: false
#| eval: true

df <- tibble::tibble(
  site_id = c("AAC101", "AAC101", "ABB011"),
  individual_id = c("B-31", "B-32", "L-12"),
  scientific_name = c("Acacia acuminata", "Acacia acuminata", "Acacia bidwillii"),
  group = c("control", "high_condition", "low_condition"),
  leaf_length = c(70.4, 84.0, 8.2),
  leaf_width = c(3.3, 2.4, 4.2),
  leaf_mass_per_area = c(105.66, 102.26, 83.98),
  temp_max = c(42.23, 42.23, 43.04),
  soil_n = c(25.67, 25.76, 37.34)
)

df |> gt::gt()
```


:::
::::
:::::


## Code comments {background-color="#2E212A" style="color: #ffffff;" transition="fade"}

::::: {style="font-size: 70%;"}

*  Short but informative
*  Too many long comments is a good indicator that code is unclear (our example from earlier needs minimal notes)

:::::

::: {.code style="font-size:60%;"}

```{r}
#| eval: false
#| echo: true
#| warning: false
#| message: false
#| class-source: shorter-chunk

# best example
library(tidyverse)
library(galah)
library(janitor)
library(sf)
library(ozmaps)

galah_config(email = "dax.kellie@csiro.au")

## Data

aus <- ozmap_states |>
  st_transform(crs = 4326) # fix projection

bandicoots <- galah_call() |>
  identify("perameles") |>
  filter(year == 2003) |>
  select(group = "basic", cl22) |>
  atlas_occurrences() 

bandicoots_clean <- bandicoots |>
  select(recordID, scientificName, decimalLongitude, 
         decimalLatitude, eventDate, cl22) |>
  janitor::clean_names() |> 
  rename(state = cl22) |>
  mutate(
    event_date = lubridate::ymd(event_date)
    ) 

state_counts <- bandicoots_clean |>
  group_by(state) |> 
  count() |> 
  drop_na()

aus_counts <- aus |>
  left_join(state_counts, join_by(NAME == state)) |>
  replace_na(list(n = 0))

## Map

ggplot() + 
  geom_sf(data = aus_counts,
          aes(fill = n),
          colour = "grey60") +
  viridis::scale_fill_viridis(option = "F", 
                              begin = 0.2, 
                              direction = -1) + 
  theme_void() + 
  theme(legend.position = "right")
```

:::

## Code comments {background-color="#2E212A" style="color: #ffffff;" transition="fade"}

::::: {style="font-size: 70%;"}

*  Use long comments to discuss *why* you did something
    -  e.g., Interpret results of a statistical test

Example: 

<center>![](images/multicollinearity-example.png){height="300"}</center>

```{r}
#| echo: true
# Variables bio_12 and bio_16 are very highly correlated (94%). 
# To avoid multicollinearity, we’ll include only bio_12 and bio_4
```

:::::

## Explaining variables {background-color="#212932" style="color: #ffffff;" transition="fade"}

::::: {style="font-size: 70%;"}

*  Sometimes you can't avoid complex code
*  Breaking up steps into smaller variables or functions can make it easier to understand your code

:::: {.columns}
::: {.column width="50%" style="font-size:80%;"}

```{r}
#| eval: false
#| echo: true

# Without explaining variable

library(ozmaps)
library(sf)
library(dplyr)

grid <- st_make_grid(ozmap_country,
                     what = "polygons",
                     cellsize = 1.0,
                     square = FALSE,
                     flat_topped = TRUE)

# subset to grid cells that are within land
aus_grid <- oz_grid[as.data.frame(st_intersects(oz_grid, ozmap_country))$row.id]
```

:::

::: {.column width="50%" style="font-size:80%;"}

```{r}
#| eval: false
#| echo: true

# With explaining variable

library(ozmaps)
library(sf)
library(dplyr)

grid <- st_make_grid(ozmap_country,
                     what = "polygons",
                     cellsize = 1.0,
                     square = FALSE,
                     flat_topped = TRUE)

hex_on_land <- grid |>
  st_intersects(ozmap_country) |>
  as.data.frame() |>
  pull(row.id)

aus_grid <- grid[hex_on_land]
```

:::

::::
:::::

:::: aside
::: {style="font-size: 50%;"}
[Explaining Variable by Pete Hodgson (2021)](https://blog.thepete.net/blog/2021/06/24/explaining-variable/)
:::
::::

## What if you are a busy scientist short on time? {background-color="#262F29" style="color: #ffffff; font-size:80%;" transition="fade"}

*  Making code understandable is more important than making it brief or fancy

::: {style="font-size: 60%;"}
:point_down: Actual terrible code from my PhD, but I still can tell what it does and could use it again (and that's the important part)!
:::
:::: {.columns}
::: {.column width="50%"}
![](images/phd-code_1.png)
:::

:::{.column width="50%"}
![](images/phd-code_2.png)
:::

::::


## Summary {background-color="#212932" style="color: #ffffff;" transition="fade"}

::::: {style="font-size: 60%;"}

:::: {.columns}
::: {.column width="60%"}

*  Use a clean and readable code style
*  Naming things
    -  Name things with simple, understandable names + avoid acronyms
    -  Make sure variable names are documented, and align with the final paper
*  Code comments
    -  Code comments should be short but clear
    -  Use long code comments to document analytic interpretations
*  Explaining variables can simplify complex code

<br>

**When you're busy, prioritise readability over brevity!**
:::

::: {.column width = "40%"}
![](images/oh-no-imagination-only.png)
:::
::::

:::: aside
::: {style="font-size: 50%;"}
[Alex Norris, webcomicname.com](https://webcomicname.com/) \
[I highly recommend watching Code Smells & Feels by Jenny Bryan for more amazing tips (aimed at programmers)](https://www.youtube.com/watch?v=7oyiPBjLAWY)
:::
::::

:::::

## Thank you {background-image="images/stripe-background.png" background-opacity="0.3"}

::: columns
::: {.column width="60%"}
::: {style="font-size: 70%;"}
<br> <b>Dax Kellie</b><br>Data Analyst & Science Lead<br>Science & Decision Support \| ALA <br>{{< fa envelope size=lg >}}: [dax.kellie@csiro.au](mailto:dax.kellie@csiro.au)<br> {{< iconify simple-icons:bluesky size=lg fill='#fe4' >}}: [\@daxkellie.bsky.social](https://bsky.app/profile/daxkellie.bsky.social)<br> {{< fa brands github size=lg >}}: [\@daxkellie](https://github.com/daxkellie) <br> <br> <b>Science & Decision Support team</b><br> Martin Westgate, Shandiya Balasubramaniam<br> Juliet Seers, Amanda Buyan<br><br><em>These slides were made using Quarto & RStudio</em>
:::
:::

::: {.column width="40%"}
<center>
Slides: <br>

![](images/qr-code.png){height=170}

--------------------------------------------------------------------------------

![](images/logos/ALA_Logo.png){style="width: auto; height: 90px"}<br> ![](images/logos/NCRIS_logo.png){style="width: auto; height: 90px"} ![](images/logos/CSIRO_logo.png){style="width: auto; height: 90px"}
</center>
:::
:::